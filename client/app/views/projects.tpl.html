<div>
	<table class="table">
		<thead>
		<tr>
			<th><!-- Aktion --></th>
			<th><a href="javascript:void(0);" ng-click="sorting = (sorting === 'title') ? '-title' : 'title'" ng-init="sorting = 'title'">
				<nobr>Titel <span class="glyphicon" ng-class="{ 'glyphicon-arrow-down': sorting === 'title', 'glyphicon-arrow-up': sorting === '-title' }"></span></nobr>
			</a></th>
			<th><a href="javascript:void(0);" ng-click="sorting = (sorting === 'description') ? '-description' : 'description'">
				<nobr>Beschreibung <span class="glyphicon" ng-class="{ 'glyphicon-arrow-down': sorting === 'description', 'glyphicon-arrow-up': sorting === '-description' }"></span></nobr>
			</a></th>
			<th><a href="javascript:void(0);" ng-click="sorting = (sorting === 'assignee.name') ? '-assignee.name' : 'assignee.name'">
				<nobr>Zugewiesen <span class="glyphicon" ng-class="{ 'glyphicon-arrow-down': sorting === 'assignee.name', 'glyphicon-arrow-up': sorting === '-assignee.name' }"></span></nobr>
			</a></th>
			<th><a href="javascript:void(0);" ng-click="sorting = (sorting === 'status') ? '-status' : 'status'">
				<nobr>Status <span class="glyphicon" ng-class="{ 'glyphicon-arrow-down': sorting === 'status', 'glyphicon-arrow-up': sorting === '-status' }"></span></nobr>
			</a></th>
			<th><a href="javascript:void(0);" ng-click="sorting = (sorting === 'startDate') ? '-startDate' : 'startDate'">
				<nobr>Start <span class="glyphicon" ng-class="{ 'glyphicon-arrow-down': sorting === 'startDate', 'glyphicon-arrow-up': sorting === '-startDate' }"></span></nobr>
			</a></th>
			<th><a href="javascript:void(0);" ng-click="sorting = (sorting === 'endDate') ? '-endDate' : 'endDate'">
				<nobr>Ende <span class="glyphicon" ng-class="{ 'glyphicon-arrow-down': sorting === 'endDate', 'glyphicon-arrow-up': sorting === '-endDate' }"></span></nobr>
			</a></th>
			<th><a href="javascript:void(0);" ng-click="sorting = (sorting === 'duration') ? '-duration' : 'duration'">
				<nobr>Aufwand<br />geschätzt <span class="glyphicon" ng-class="{ 'glyphicon-arrow-down': sorting === 'duration', 'glyphicon-arrow-up': sorting === '-duration' }"></span></nobr>
			</a></th>
			<th><a href="javascript:void(0);" ng-click="sorting = (sorting === 'effort') ? '-effort' : 'effort'">
				<nobr>Zeit<br />aufgewendet <span class="glyphicon" ng-class="{ 'glyphicon-arrow-down': sorting === 'effort', 'glyphicon-arrow-up': sorting === '-effort' }"></span></nobr>
			</a></th>
			<th><a href="javascript:void(0);" ng-click="sorting = (sorting === 'progress') ? '-progress' : 'progress'">
				<nobr>Fortschritt <span class="glyphicon" ng-class="{ 'glyphicon-arrow-down': sorting === 'progress', 'glyphicon-arrow-up': sorting === '-progress' }"></span></nobr>
			</a></th>
		</tr>
		</thead>
		<tbody>
		<tr>
			<td colspan="10">
				<button class="btn btn-default btn-block" ng-click="newProject()"><b>Neues Projekt erstellen</b></button>
			</td>
		</tr>
		<tr class="ng-table-group" ng-repeat-start="project in projects | orderBy:sorting" ng-controller="ProjectCtrl">
			<!-- Action -->
			<td class="text-center">
				<input type="checkbox" ng-click="selectProject(project)" ng-checked="selectedProject === project"/>
			</td>

			<!-- Title -->
			<td>
				<nobr ng-hide="editable.title">
					<span ng-click="editable.title = true">{{ project.title }} </span>
					<a href="javascript:void(0);"
					   class="glyphicon"
					   ng-class="{ 'glyphicon-plus': !project.$ui.showTasks, 'glyphicon-minus': project.$ui.showTasks }"
					   ng-click="showTasks(project)">
					</a>
				</nobr>
				<div ng-if="editable.title">
					<input type="text"
						   ng-model="project.title"
						   pp-model=""
						   set-focus=""
						   ng-blur="editable.title = false; updateProject();"
						   ng-enter="editable.title = false; updateProject();">
				</div>
			</td>

			<!-- Description -->
			<td>
				<nobr>{{ project.description | limitTo:20 }}</nobr>
			</td>

			<!-- Assignee -->
			<td>
				<nobr ng-hide="editable.assignee">
					<span ng-click="editable.assignee = true">{{ project.assignee.name }}</span>
				</nobr>
				<div ng-if="editable.assignee">
					<select ng-model="project.assignee"
							ng-options="user as user.name for user in assignableUsers track by user.id"
							set-focus=""
							ng-blur="editable.assignee = false; updateProject();">
					</select>
				</div>
			</td>

			<!-- Status -->
			<td>
				<nobr ng-hide="editable.status">
					<span ng-click="editable.status = true">{{ project.status }}</span>
				</nobr>
				<div ng-if="editable.status">
					<select ng-model="project.status"
							ng-options="value for value in project.statusList"
							set-focus=""
							ng-blur="editable.status = false; updateProject();">
					</select>
				</div>
			</td>

			<!-- Start Date -->
			<td>
				<nobr ng-hide="editable.startDate || editable.datepicker.startDate">
					<span ng-click="editable.startDate = true; openDatePicker($event, 'startDate')">{{ project.startDate | date:'dd.MM.yyyy' }}</span>
				</nobr>
				<div ng-if="editable.startDate || editable.datepicker.startDate">
					<input ng-model="project.startDate"
						   pp-convert-date="dd.MM.yyyy"
						   datepicker-popup="dd.MM.yyyy"
						   min="'1900-01-01'"
						   max="'2100-01-01'"
						   is-open="editable.datepicker.startDate"
						   ng-blur="editable.startDate = false; updateProject();">
				</div>
			</td>

			<!-- End Date -->
			<td>
				<nobr ng-hide="editable.endDate || editable.datepicker.endDate">
					<span ng-click="editable.endDate = true; openDatePicker($event, 'endDate')">{{ project.endDate | date:'dd.MM.yyyy' }}</span>
				</nobr>
				<div ng-if="editable.endDate || editable.datepicker.endDate">
					<input ng-model="project.endDate"
						   pp-convert-date="dd.MM.yyyy"
						   datepicker-popup="dd.MM.yyyy"
						   min="'1900-01-01'"
						   max="'2100-01-01'"
						   is-open="editable.datepicker.endDate"
						   ng-blur="editable.endDate = false; updateProject();">
				</div>
			</td>

			<!-- Duration -->
			<td>
				<nobr ng-hide="editable.duration">
					<span ng-click="editable.duration = true">{{ project.duration | minutesToHours | number:2 }}h</span>
				</nobr>
				<div ng-if="editable.duration">
					<input ng-model="project.duration"
						   pp-model=""
						   pp-convert-time=""
						   type="text"
						   set-focus=""
						   ng-blur="editable.duration = false; updateProject();"
						   ng-enter="editable.duration = false; updateProject();">
				</div>
			</td>

			<!-- Effort -->
			<td>
				<nobr ng-hide="editable.effort">
					<span ng-click="editable.effort = true">{{ project.effort | minutesToHours | number:2 }}h</span>
				</nobr>
				<div ng-if="editable.effort">
					<input ng-model="project.effort"
						   pp-model=""
						   pp-convert-time=""
						   type="text"
						   set-focus=""
						   ng-blur="editable.effort = false; updateProject();"
						   ng-enter="editable.effort = false; updateProject();">
				</div>
			</td>

			<!-- Progress -->
			<td>
				<nobr ng-hide="editable.progress">
					<span ng-click="editable.progress = true">{{ project.progress * 100 | number:2 }}%</span>
				</nobr>
				<div ng-if="editable.progress">
					<input ng-model="project.progress"
						   pp-model=""
						   pp-convert-percent=""
						   type="number"
						   min="0"
						   max="100"
						   set-focus=""
						   ng-blur="editable.progress = false; updateProject();"
						   ng-enter="editable.progress = false; updateProject();">
				</div>
			</td>
		</tr>
		<tr ng-repeat="task in project.getTasks() | orderBy:taskSorting" ng-if="project.$ui.showTasks" ng-init="taskSorting = 'title'" ng-repeat-end="">
			<td></td>
			<td>{{ task.title }}</td>
			<td>{{ task.description | limitTo: 20 }}</td>
			<td>{{ task.assignee.name }}</td>
			<td>{{ task.getStatus() }}</td>
			<td>{{ task.startDate | date:'dd.MM.yyyy' }}</td>
			<td>{{ task.endDate | date:'dd.MM.yyyy' }}</td>
			<td>{{ task.duration | minutesToHours | number:2 }}h</td>
			<td>{{ task.effort | minutesToHours | number:2 }}h</td>
			<td>{{ task.progress * 100 }}</td>
		</tr>
		</tbody>
	</table>
	<div class="dropdown">
		<button href="javascript:void(0);" class="dropdown-toggle btn btn-default" ng-disabled="disableActions()">Aktion auswählen</button>
		<ul class="dropdown-menu">
			<li>
				<a href="javascript:void(0);" ng-click="editSelected()">Projekt bearbeiten</a>
			</li>
			<li>
				<a href="javascript:void(0);" ng-click="createProjectTask()">Aufgabe für Projekt erstellen</a>
			</li>
			<li>
				<!--<a href="javascript:void(0);" ng-click="createSubProject()">Unterprojekt erstellen</a>-->
			</li>
			<li>
				<a href="javascript:void(0);" ng-click="deleteSelected()">Löschen</a>
			</li>
		</ul>
	</div>
</div>