<div>
	<div class="loader" ng-show="loader.projects || loader.users"></div>
	<table class="table" ng-hide="loader.projects || loader.users">
		<thead>
		<tr>
			<th><!-- Aktion --></th>
			<th><a href="javascript:void(0);" ng-click="sorting = (sorting === 'title') ? '-title' : 'title'" ng-init="sorting = 'title'">
				<nobr>Titel <span class="glyphicon" ng-class="{ 'glyphicon-arrow-down': sorting === 'title', 'glyphicon-arrow-up': sorting === '-title' }"></span></nobr>
			</a></th>
			<th></th>
			<th><a href="javascript:void(0);" ng-click="sorting = (sorting === 'assignee.name') ? '-assignee.name' : 'assignee.name'">
				<nobr>Zugewiesen <span class="glyphicon" ng-class="{ 'glyphicon-arrow-down': sorting === 'assignee.name', 'glyphicon-arrow-up': sorting === '-assignee.name' }"></span></nobr>
			</a></th>
			<th><a href="javascript:void(0);" ng-click="sorting = (sorting === 'status') ? '-status' : 'status'">
				<nobr>Status <span class="glyphicon" ng-class="{ 'glyphicon-arrow-down': sorting === 'status', 'glyphicon-arrow-up': sorting === '-status' }"></span></nobr>
			</a></th>
			<th><a href="javascript:void(0);" ng-click="sorting = (sorting === 'startDate') ? '-startDate' : 'startDate'">
				<nobr>Start <span class="glyphicon" ng-class="{ 'glyphicon-arrow-down': sorting === 'startDate', 'glyphicon-arrow-up': sorting === '-startDate' }"></span></nobr>
			</a></th>
			<th><a href="javascript:void(0);" ng-click="sorting = (sorting === 'endDate') ? '-endDate' : 'endDate'">
				<nobr>Ende <span class="glyphicon" ng-class="{ 'glyphicon-arrow-down': sorting === 'endDate', 'glyphicon-arrow-up': sorting === '-endDate' }"></span></nobr>
			</a></th>
			<th><a href="javascript:void(0);" ng-click="sorting = (sorting === 'duration') ? '-duration' : 'duration'">
				<nobr>Aufwand<br />geschätzt <span class="glyphicon" ng-class="{ 'glyphicon-arrow-down': sorting === 'duration', 'glyphicon-arrow-up': sorting === '-duration' }"></span></nobr>
			</a></th>
			<th><a href="javascript:void(0);" ng-click="sorting = (sorting === 'effort') ? '-effort' : 'effort'">
				<nobr>Zeit<br />aufgewendet <span class="glyphicon" ng-class="{ 'glyphicon-arrow-down': sorting === 'effort', 'glyphicon-arrow-up': sorting === '-effort' }"></span></nobr>
			</a></th>
			<th><a href="javascript:void(0);" ng-click="sorting = (sorting === 'progress') ? '-progress' : 'progress'">
				<nobr>Fortschritt <span class="glyphicon" ng-class="{ 'glyphicon-arrow-down': sorting === 'progress', 'glyphicon-arrow-up': sorting === '-progress' }"></span></nobr>
			</a></th>
		</tr>
		</thead>
		<tbody>
		<tr>
			<td colspan="11">
				<button class="btn btn-default btn-block" ng-click="newProject()"><b>Neues Projekt erstellen</b></button>
			</td>
		</tr>
		<tr class="ng-table-group" ng-repeat-start="project in list.projects | orderBy:sorting" ng-controller="ProjectCtrl">
			<!-- Action -->
			<td class="text-center">
				<img ng-show="item.loader.edit" src="images/load_indicator.gif" height="18px" width="18px" />
				<input ng-hide="item.loader.edit" type="checkbox" ng-click="selectProject(project)" ng-checked="list.selectedProject === project"/>
			</td>

			<!-- Title -->
			<td>
				<nobr ng-hide="editable.title">
					<span class="editable" ng-click="editable.title = true">{{ project.title }} </span>
					<a href="javascript:void(0);"
					   class="glyphicon"
					   ng-hide="item.loader.tasks.load"
					   ng-class="{ 'glyphicon-plus': !project.$ui.showTasks, 'glyphicon-minus': project.$ui.showTasks }"
					   ng-click="showTasks(project)"
					   ng-if="project.taskCount > 0">
					</a>
					<img src="images/load_indicator.gif" height="12px" width="12px" ng-show="item.loader.tasks.load" />
				</nobr>
				<div ng-if="editable.title">
					<input type="text"
						   ng-model="project.title"
						   pp-model=""
						   set-focus=""
						   ng-blur="editable.title = false"
						   ng-change="editable.title = false; updateProject()">
				</div>
			</td>

			<!-- Description -->
			<td>
				<nobr>
					<button type="button" class="btn btn-xs btn-default" ng-click="list.selectedProject = project; editSelectedProject()">Bearbeiten</button>
				</nobr>
			</td>

			<!-- Owner -->
			<td>
				<nobr ng-hide="editable.owner">
					<span class="editable" ng-click="editable.owner = true">{{ (project.owner) ? project.owner.firstName + ' ' + project.owner.lastName : 'no owner'}}</span>
				</nobr>
				<div ng-if="editable.owner">
					<select ng-model="project.owner"
							ng-options="user as (user.firstName + ' ' + user.lastName) for user in list.assignableUsers track by user.id"
							set-focus=""
							ng-blur="editable.owner = false"
							ng-change="editable.owner = false; assignProjectToUser(project)">
					</select>
				</div>
			</td>

			<!-- Status -->
			<td>
				<nobr ng-hide="editable.status">
					<span class="editable" ng-click="editable.status = true">{{ project.statusList[project.status] }}</span>
				</nobr>
				<div ng-if="editable.status">
					<select ng-model="project.status"
							ng-options="key as status for (key, status) in project.statusList"
							set-focus=""
							ng-blur="editable.status = false"
							ng-change="editable.status = false; updateProject()">
					</select>
				</div>
			</td>

			<!-- Start Date -->
			<td>
				<nobr ng-hide="list.datepicker[project.id + 'startDate']">
					<span ng-click="openDatePicker($event, project.id + 'startDate')" class="editable">{{ (project.startDate | date:'dd.MM.yyyy') || '-----' }}</span>
				</nobr>
				<div ng-if="list.datepicker[project.id + 'startDate']">
					<input ng-model="project.startDate"
						   pp-convert-date="dd.MM.yyyy"
						   datepicker-popup="dd.MM.yyyy"
						   min="'1900-01-01'"
						   max="project.endDate"
						   ng-blur="form.datePickerOpened = false"
						   is-open="list.datepicker[project.id + 'startDate']"
						   disabled="disabled"
						   ng-change="updateProject()">
				</div>
			</td>

			<!-- End Date -->
			<td>
				<nobr ng-hide="list.datepicker[project.id + 'endDate']">
					<span ng-click="openDatePicker($event, project.id + 'endDate')" class="editable">{{ (project.endDate | date:'dd.MM.yyyy') || '-----' }}</span>
				</nobr>
				<div ng-if="list.datepicker[project.id + 'endDate']">
					<input ng-model="project.endDate"
						   pp-convert-date="dd.MM.yyyy"
						   datepicker-popup="dd.MM.yyyy"
						   min="project.startDate"
						   max="'2100-01-01'"
						   ng-blur="form.datePickerOpened = false"
						   is-open="list.datepicker[project.id + 'endDate']"
						   disabled="disabled"
						   ng-change="updateProject()">
				</div>
			</td>

			<!-- Duration -->
			<td>
				<nobr ng-hide="editable.duration">
					<span class="editable" ng-click="editable.duration = true">{{ project.duration | minutesToHours | number:2 }}h</span>
				</nobr>
				<div ng-if="editable.duration">
					<input ng-model="project.duration"
						   pp-model=""
						   pp-convert-time=""
						   type="text"
						   set-focus=""
						   ng-blur="editable.duration = false"
						   ng-change="editable.duration = false; updateProject()">
				</div>
			</td>

			<!-- Effort -->
			<td>
				<nobr ng-hide="editable.effort">
					<span class="editable" ng-click="editable.effort = true">{{ project.effort | minutesToHours | number:2 }}h</span>
				</nobr>
				<div ng-if="editable.effort">
					<input ng-model="project.effort"
						   pp-model=""
						   pp-convert-time=""
						   type="text"
						   set-focus=""
						   ng-blur="editable.effort = false"
						   ng-change="editable.effort = false; updateProject()">
				</div>
			</td>

			<!-- Progress -->
			<td>
				<nobr ng-hide="editable.progress">
					<span class="editable" ng-click="editable.progress = true">{{ project.progress * 100 | number:2 }}%</span>
				</nobr>
				<div ng-if="editable.progress">
					<input ng-model="project.progress"
						   pp-model=""
						   pp-convert-percent=""
						   type="number"
						   min="0"
						   max="100"
						   set-focus=""
						   ng-blur="editable.progress = false"
						   ng-change="editable.progress = false; updateProject()">
				</div>
			</td>
		</tr>
		<tr ng-repeat="task in project.getTasks() | orderBy:taskSorting" ng-if="project.$ui.showTasks" ng-init="taskSorting = 'title'" ng-repeat-end="">
			<td></td>
			<td>{{ task.title }}</td>
			<td>{{ task.description | limitTo: 20 }}</td>
			<td>{{ task.assignee.firstName + ' ' + task.assignee.lastName }}</td>
			<td>{{ task.statusList[project.status] }}</td>
			<td>{{ task.startDate | date:'dd.MM.yyyy' }}</td>
			<td>{{ task.endDate | date:'dd.MM.yyyy' }}</td>
			<td>{{ task.duration | minutesToHours | number:2 }}h</td>
			<td>{{ task.effort | minutesToHours | number:2 }}h</td>
			<td>{{ task.progress * 100 }}</td>
		</tr>
		</tbody>
	</table>
	<div class="dropdown">
		<button href="javascript:void(0);" class="dropdown-toggle btn btn-default" ng-disabled="disableActions()">Aktion auswählen</button>
		<ul class="dropdown-menu">
			<li>
				<a href="javascript:void(0);" ng-click="editSelectedProject()">Projekt bearbeiten</a>
			</li>
			<li>
				<a href="javascript:void(0);" ng-click="createProjectTask()">Aufgabe für Projekt erstellen</a>
			</li>
			<li>
				<a href="javascript:void(0);" ng-click="deleteSelected()">Löschen</a>
			</li>
		</ul>
	</div>
</div>