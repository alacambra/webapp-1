<div>
<table class="table">
	<thead>
	<tr>
		<th><!-- Aktion --></th>
		<th><a href="javascript:void(0);" ng-click="sorting = (sorting === 'title') ? '-title' : 'title'" ng-init="sorting = 'title'">
			<nobr>Titel <span class="glyphicon" ng-class="{ 'glyphicon-arrow-down': sorting === 'title', 'glyphicon-arrow-up': sorting === '-title' }"></span></nobr>
		</a></th>
		<th><a href="javascript:void(0);" ng-click="sorting = (sorting === 'description') ? '-description' : 'description'">
			<nobr>Beschreibung <span class="glyphicon" ng-class="{ 'glyphicon-arrow-down': sorting === 'description', 'glyphicon-arrow-up': sorting === '-description' }"></span></nobr>
		</a></th>
		<th><a href="javascript:void(0);" ng-click="sorting = (sorting === 'assignee.firstName') ? '-assignee.firstName' : 'assignee.firstName'">
			<nobr>Zugewiesen <span class="glyphicon" ng-class="{ 'glyphicon-arrow-down': sorting === 'assignee.firstName', 'glyphicon-arrow-up': sorting === '-assignee.firstName' }"></span></nobr>
		</a></th>
		<th><a href="javascript:void(0);" ng-click="sorting = (sorting === 'status') ? '-status' : 'status'">
			<nobr>Status <span class="glyphicon" ng-class="{ 'glyphicon-arrow-down': sorting === 'status', 'glyphicon-arrow-up': sorting === '-status' }"></span></nobr>
		</a></th>
		<th><a href="javascript:void(0);" ng-click="sorting = (sorting === 'startDate') ? '-startDate' : 'startDate'">
			<nobr>Start <span class="glyphicon" ng-class="{ 'glyphicon-arrow-down': sorting === 'startDate', 'glyphicon-arrow-up': sorting === '-startDate' }"></span></nobr>
		</a></th>
		<th><a href="javascript:void(0);" ng-click="sorting = (sorting === 'endDate') ? '-endDate' : 'endDate'">
			<nobr>Ende <span class="glyphicon" ng-class="{ 'glyphicon-arrow-down': sorting === 'endDate', 'glyphicon-arrow-up': sorting === '-endDate' }"></span></nobr>
		</a></th>
		<th><a href="javascript:void(0);" ng-click="sorting = (sorting === 'duration') ? '-duration' : 'duration'">
			<nobr>Aufwand<br />geschätzt <span class="glyphicon" ng-class="{ 'glyphicon-arrow-down': sorting === 'duration', 'glyphicon-arrow-up': sorting === '-duration' }"></span></nobr>
		</a></th>
		<th><a href="javascript:void(0);" ng-click="sorting = (sorting === 'effort') ? '-effort' : 'effort'">
			<nobr>Zeit<br />aufgewendet <span class="glyphicon" ng-class="{ 'glyphicon-arrow-down': sorting === 'effort', 'glyphicon-arrow-up': sorting === '-effort' }"></span></nobr>
		</a></th>
		<th><a href="javascript:void(0);" ng-click="sorting = (sorting === 'progress') ? '-progress' : 'progress'">
			<nobr>Fortschritt <span class="glyphicon" ng-class="{ 'glyphicon-arrow-down': sorting === 'progress', 'glyphicon-arrow-up': sorting === '-progress' }"></span></nobr>
		</a></th>
		<th><a href="javascript:void(0);" ng-click="sorting = (sorting === 'project.title') ? '-project.title' : 'project.title'">
			<nobr>Projekt <span class="glyphicon" ng-class="{ 'glyphicon-arrow-down': sorting === 'project.title', 'glyphicon-arrow-up': sorting === '-project.title' }"></span></nobr>
		</a></th>
	</tr>
	</thead>
	<tbody>
	<tr ng-repeat="task in list.tasks | orderBy:sorting" ng-controller="TaskCtrl">
		<!-- Action -->
		<td class="text-center">
			<input type="checkbox" ng-click="selectTask(task)" ng-checked="listselectedTask === task"/>
		</td>

		<!-- Title -->
		<td>
			<nobr ng-hide="editable.title">
				<span class="editable" ng-click="editable.title = true">{{ task.title }} </span>
				<a href="javascript:void(0);"
				   class="glyphicon"
				   ng-class="{ 'glyphicon-plus': !task.$ui.showTasks, 'glyphicon-minus': task.$ui.showTasks }"
				   ng-click="showSubTasks(task)"
				   ng-show="task.hasTasks()">
				</a>
			</nobr>
			<div ng-if="editable.title">
				<input type="text"
					   ng-model="task.title"
					   pp-model=""
					   set-focus=""
					   ng-blur="editable.title = false"
					   ng-change="editable.title = false; updateTask()">
			</div>
		</td>

		<!-- Description -->
		<td>
			<nobr>{{ task.description | limitTo:20 }}</nobr>
		</td>

		<!-- Assignee -->
		<td>
			<nobr ng-hide="editable.assignee">
				<span class="editable" ng-click="editable.assignee = true">{{ (task.assignee) ? task.assignee.firstName + ' ' + task.assignee.lastName : 'no assignee'}}</span>
			</nobr>
			<div ng-if="editable.assignee">
				<select ng-model="task.assignee"
						ng-options="user as (user.firstName + ' ' + user.lastName) for user in list.assignableUsers track by user.id"
						set-focus=""
						ng-blur="editable.assignee = false"
						ng-change="editable.assignee = false; assignUserToTask(task)">
				</select>
			</div>
		</td>

		<!-- Status -->
		<td>
			<nobr ng-hide="editable.status">
				<span class="editable" ng-click="editable.status = true">{{ task.statusList[task.status] }}</span>
			</nobr>
			<div ng-if="editable.status">
				<select ng-model="task.status"
						ng-options="key as status for (key, status) in task.statusList"
						set-focus=""
						ng-blur="editable.status = false"
						ng-change="editable.status = false; updateTask()">
				</select>
			</div>
		</td>

		<!-- Start Date -->
		<td>
			<nobr ng-hide="list.datepicker[task.id + 'startDate']">
				<span ng-click="openDatePicker($event, task.id + 'startDate')" class="editable">{{ (task.startDate | date:'dd.MM.yyyy') || '-----' }}</span>
			</nobr>
			<div ng-if="list.datepicker[task.id + 'startDate']">
				<input ng-model="task.startDate"
					   pp-convert-date="dd.MM.yyyy"
					   datepicker-popup="dd.MM.yyyy"
					   min="'1900-01-01'"
					   max="task.endDate"
					   is-open="list.datepicker[task.id + 'startDate']"
					   disabled="disabled"
					   ng-change="updateTask()">
			</div>
		</td>

		<!-- End Date -->
		<td>
			<nobr ng-hide="list.datepicker[task.id + 'endDate']">
				<span ng-click="openDatePicker($event, task.id + 'endDate')" class="editable">{{ (task.endDate | date:'dd.MM.yyyy') || '-----' }}</span>
			</nobr>
			<div ng-if="list.datepicker[task.id + 'endDate']">{{list.datepicker[task.id]}}
				<input ng-model="task.endDate"
					   pp-convert-date="dd.MM.yyyy"
					   datepicker-popup="dd.MM.yyyy"
					   min="task.startDate"
					   max="'2100-01-01'"
					   is-open="list.datepicker[task.id + 'endDate']"
					   disabled="disabled"
					   ng-change="updateTask()">
			</div>
		</td>

		<!-- Duration -->
		<td>
			<nobr ng-hide="editable.duration">
				<span class="editable" ng-click="editable.duration = true">{{ task.duration | minutesToHours | number:2 }}h</span>
			</nobr>
			<div ng-if="editable.duration">
				<input ng-model="task.duration"
					   pp-model=""
					   pp-convert-time=""
					   type="text"
					   set-focus=""
					   ng-blur="editable.duration = false"
					   ng-change="editable.duration = false; updateTask()">
			</div>
		</td>

		<!-- Effort -->
		<td>
			<nobr>
				<span class="editable" ng-click="bookEffort(task)">{{ task.effort | minutesToHours | number:2 }}h</span>
			</nobr>
		</td>

		<!-- Progress -->
		<td>
			<nobr ng-hide="editable.progress">
				<span class="editable" ng-click="editable.progress = true">{{ task.progress * 100 | number:2 }}%</span>
			</nobr>
			<div ng-if="editable.progress">
				<input ng-model="task.progress"
					   pp-model=""
					   pp-convert-percent=""
					   type="number"
					   min="0"
					   max="100"
					   set-focus=""
					   ng-blur="editable.progress = false"
					   ng-change="editable.progress = false; updateTask()">
			</div>
		</td>

		<!-- Project -->
		<td>
			<nobr ng-hide="editable.project">
				<span class="editable" ng-click="editable.project = true">{{ task.project.title }}</span>
			</nobr>
			<div ng-if="editable.project">
				<select ng-model="task.project"
						ng-options="project as project.title for project in list.assignableProjects track by project.id"
						set-focus=""
						ng-blur="editable.project = false"
						ng-change="editable.project = false; updateTaskProject();">
				</select>
			</div>
		</td>
	</tr>
	</tbody>
</table>
<div class="dropdown">
	<button href="javascript:void(0);" class="dropdown-toggle btn btn-default">Aktion auswählen</button>
	<ul class="dropdown-menu">
		<li>
			<a href="javascript:void(0);" ng-click="newTask()">Neue Aufgabe</a>
		</li>
		<li>
			<a href="javascript:void(0);" ng-click="bookEffort()" ng-if="list.selectedTask">Effort buchen</a>
		</li>
		<li>
			<a href="javascript:void(0);" ng-click="editSelected()" ng-if="list.selectedTask">Task bearbeiten</a>
		</li>
		<li>
			<a href="javascript:void(0);" ng-click="deleteSelected()" ng-if="list.selectedTask">Löschen</a>
		</li>
	</ul>
</div>
</div>